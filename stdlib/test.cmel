// ANSI color codes (using \e for ESC character)
var RESET = "\e[0m";
var BOLD = "\e[1m";
var GREEN = "\e[32m";
var RED = "\e[31m";
var CYAN = "\e[36m";
var GRAY = "\e[90m";

var testSuites = [];
var currentSuite = nil;

// Enable test mode when module loads
__enterTestMode();

export fun suite(name, fn) {
    print BOLD + CYAN + name + RESET;
    fn();
}

export fun test(description, testFn) {
    __setCurrentTest(description);
    __clearLastFailure();

    testFn();

    if (__testFailed()) {
        var failure = __getLastFailure();
        print RED + "  ✗ " + RESET + GRAY + description + RESET;
        print RED + "    " + failure + RESET;
    } else {
        print GREEN + "  ✓ " + RESET + description;
    }
}

export fun run() {
    __exitTestMode();
}

// Export assertion functions
export var assert = __assert;
export var assertEqual = __assertEqual;
